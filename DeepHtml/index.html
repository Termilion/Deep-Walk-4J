
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!--<script src="javascripts/jquery.tablesorter.min.js"></script>-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>DeepVis</title>
    <link rel="stylesheet" href="def.css">
</head>
<body>
<h1>
    DeepLearning4J
</h1>
<hr>
<h3>Description</h3>
1. Choose a nodeId<br>
<p>
    2. Select an action
</p>

<hr>

<form action="./" method="get">
<div class="form-row">
    <div class="form-group col-md-5">
        <label for="nodeId">nodeOne</label>
        <input type="text" class="form-control" placeholder="nodeId" id="nodeId" name="s" value="12831">
    </div>
</div>
<div class="form-group col-md-2">
    <label for="action">action</label>
    <select id="action" class="form-control" onchange="change_action(document.getElementById('action').value)">
        <option value="CompareTo">CompareTo</option>
        <option value="K-Top">K-Top Similar</option>
    </select>
</div>
<div class="form-group col-md-5 d1">
    <label for="nodeId2">nodeTwo</label>
    <input type="text" class="form-control" placeholder="nodeId" id="nodeId2" name="s" value="761">
    <!-- <button id="sourceList" type="button" class="btn btn-primary btn-lg">Large button</button> -->
</div>
    <div style="display: none;" class="form-group col-md-5 d2" >
        <label for="knumber">top</label>
        <input type="text" class="form-control" placeholder="number of k" id="knumber" name="s" value="5">
        <!-- <button id="sourceList" type="button" class="btn btn-primary btn-lg">Large button</button> -->
    </div>
</form>
<div class="box1">
    ParagraphVec
</div>
<div class="box2">
    DeepWalk
</div>
<div height="50px" width="100%">
    <p class="log" height="50px" style="padding:10px"></p>
</div>
</body>
<script>
    function loadGraph(div, path) {
        //width and height
        var w = 500;
        var h = 400;
        var padding = 40;

        var vectorNodes = [];
        var svg = d3.select(div)
            .append("svg")
            .attr("width", w)
            .attr("height", h);

        var isSelected = null;

        d3.text(path).then(function (d) {
            var vectors = d.split("\n");
            vectors.forEach(function (vec) {
                var values = vec.split("\t");
                if(values.length >= 4) vectorNodes.push({id: values[0], x: values[1], y: values[2], z: values[3]});
            });
            var xmax = Math.max.apply(Math, vectorNodes.map(function(d){return d.x;}));
            var ymax = Math.max.apply(Math, vectorNodes.map(function(d){return d.y;}));
            var zmax = Math.max.apply(Math, vectorNodes.map(function(d){return d.z;}));
            var xmin = Math.min.apply(Math, vectorNodes.map(function(d){return d.x;}));
            var ymin = Math.min.apply(Math, vectorNodes.map(function(d){return d.y;}));
            var zmin = Math.min.apply(Math, vectorNodes.map(function(d){return d.z;}));
            //scale function
            var xScale = d3.scaleLinear()
                .domain([xmin-0.1, xmax+0.1])
                .range([padding, w - padding * 2]);
            var yScale = d3.scaleLinear()
                .domain([ymin-0.1, ymax+0.1])
                .range([h - padding, padding]);
            var zScale = d3.scaleLinear()
                .domain([zmin, zmax])
                .range([10, 3]);
            var colorScale = d3.scaleLinear()
                .domain([zmin, zmax])
                .range(["blue", "red"]);

            var xAxis = d3.axisBottom().scale(xScale).ticks(10);
            var yAxis = d3.axisLeft().scale(yScale).ticks(10);

            //Sort so smaller nodes get displayed in front of larger nodes
            vectorNodes.sort(function (a, b) {return a.z - b.z;});

            svg.selectAll("circle").data(vectorNodes).enter().append("circle")
                .attr("id", function (d) {
                    return "c"+d.id;
                })
                .attr("cx", function (d) {
                    return xScale(d.x);
                })
                .attr("cy", function(d){
                    return yScale(d.y);
                })
                .attr("r", function(d){
                    return zScale(d.z);
                })
                .attr("fill", function (d) {
                    return colorScale(d.z);
                })
                .attr("stroke","white")
                .on("mouseover", function(d) {
                    d3.select(".log")
                        .html(d.id + "<br/>"  + d.x + ", " + d.y + ", " + d.z);
                    d3.selectAll("#c"+d.id).transition().attr("r",function (d) {
                        return zScale(d.z)+10;
                    });
                })
                .on("mouseout", function(d) {
                    if(isSelected !== d.id){
                        d3.select(".log")
                            .html("<br/>");
                        d3.selectAll("#c"+d.id).transition().attr("r", function (d) {
                            return zScale(d.z);
                        });
                    }
                })
                .on("click", function(d) {
                    if(isSelected != null) {
                        if(isSelected === d.id) {
                            d3.selectAll("#c"+d.id).attr("fill", colorScale(d.z));
                            d3.select(".log")
                                .html("<br/>");
                            isSelected = null;
                        } else {
                            d3.selectAll(".c"+isSelected).attr("fill", colorScale(d.z));
                            d3.selectAll("#c"+d.id).attr("fill", "green");
                            isSelected = d.id;
                            d3.selectAll("#c"+d.id).transition().attr("r",function (d) {
                                return zScale(d.z)+5;
                            });
                        }
                    } else {
                        d3.selectAll("#c"+d.id).attr("fill", "green");
                        isSelected = d.id;
                    }
                });

            //x axis
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (h - padding) + ")")
                .call(xAxis);

            //y axis
            svg.append("g")
                .attr("class", "y axis")
                .attr("transform", "translate(" + padding + ", 0)")
                .call(yAxis);
        }, function (e) {
            throw e;
        });
    }
    loadGraph(".box1", "../twitter-prepro/paraVec-3-25.pv");
    loadGraph(".box2", "../twitter-prepro/deepWalk-400-200-3.dw");
</script>
<script>
    //document.getElementById('d2').attr("disabled", true)
    function change_action(selected_action){

        action = document.getElementById('action').value;
        console.log(action);

        if( action == "CompareTo" ) {
            console.log("yes");
            $('.d2').css('display', 'none');
            $('.d1').css('display', 'block');
        } else {
            $('.d1').css('display', 'none');
            $('.d2').css('display', 'block');
        }

        //if( selected_action == "K-Top" ) {
        //    document.getElementById('nodeId2').readOnly = true;
        //} else {
        //    document.getElementById('nodeId2').readOnly = false;
        //}
        //var current = window.location.href;
        //current = current.substr(0,current.indexOf('?'))
        //window.location.href = current+ "?action="+encodeURIComponent(document.getElementById('action').value);
    }
</script>